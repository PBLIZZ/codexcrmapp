# CodexCRM Monorepo Refactoring Tasks

## PHASE 1: DISCOVERY & AUDIT

### TASK 1: Scan Monorepo File System for Code Files and Directory Structure

**Prerequisites:** Node.js installed, access to monorepo root  
**Input:** Entire monorepo directory with file patterns `/*.tsx`, `app/*/page.tsx`, `src/components/**`  
**Output:** JSON report listing full file paths per matching pattern  
**Validation:** Confirm JSON report contains a verified list of files and matches result counts from `find . -type f -name '*.tsx'` commands

#### SUBTASK 1.1
Run CLI command `find . -type f -name '*.tsx'` and `find app -type f -name 'page.tsx'` to collect file paths

#### SUBTASK 1.2
Aggregate results into a JSON file with keys for each file pattern

---

### TASK 2: Identify Naming Convention Violations in Code Files

**Prerequisites:** Completion of TASK 1 and availability of naming guidelines from general-principles-for-naming-conventions.md  
**Input:** JSON file list from TASK 1 filtered for `src/components/**` and `app/**/page.tsx`  
**Output:** CSV report with columns: file path, expected naming pattern (regex: `"^[A-Z][a-zA-Z0-9]+\.tsx$"`), and status violation flag  
**Validation:** Validate that each file name is checked against regex; report must list any deviation and target zero violations ideally

#### SUBTASK 2.1
For each file in the specified directories, use a regex matcher to check if the file name matches `"^[A-Z][a-zA-Z0-9]+\.tsx$"`

#### SUBTASK 2.2
Generate a CSV report recording violations and file paths

---

### TASK 3: Validate App Router Compliance for Next.js 15 Standards

**Prerequisites:** TASK 1 completion; Next.js 15 installed and configured  
**Input:** All files in `app/*/page.tsx` and corresponding layout files in `app/*/layout.tsx`  
**Output:** JSON report listing each app directory with "compliant: true/false" flags and detected deviations  
**Validation:** Verify that the JSON report indicates 100% compliance with App Router structural conventions (each directory must contain a page.tsx and optional layout.tsx following Next.js 15 patterns)

#### SUBTASK 3.1
Execute an automated linter or custom script (e.g., `npx check-app-router`) to analyze page and layout files

#### SUBTASK 3.2
Compile results into a JSON report detailing directory compliance

---

### TASK 4: Identify and Report Dead Code in the Monorepo

**Prerequisites:** ESLint installed with no-unused-vars and dead code rules enabled  
**Input:** Entire monorepo source files matching `**/*.tsx` and other script files  
**Output:** JSON report listing file paths, line numbers, and dead (unused) code segments identified  
**Validation:** Validate that the report correctly logs unused variables/functions; ideally, the output should minimize or list zero intentional dead code

#### SUBTASK 4.1
Run ESLint with the command `npx eslint **/*.tsx --rule 'no-unused-vars: error'` and capture output

#### SUBTASK 4.2
Parse ESLint output into a structured JSON file with relevant details

---

### TASK 5: Establish a Performance Baseline for the Current Monorepo Build

**Prerequisites:** Monorepo is buildable using Next.js 15 and all dependencies are installed  
**Input:** Next.js application directory (e.g., app and src directories)  
**Output:** JSON report containing performance metrics (build time, bundle size, Time-to-Interactive, etc.) generated by running `npx next build --profile`  
**Validation:** Confirm that the performance JSON report includes all key metrics and that baseline values are recorded for future comparison

#### SUBTASK 5.1
Execute `npx next build --profile` and capture performance logs

#### SUBTASK 5.2
Extract and structure the profiling data into a JSON baseline report

---

## PHASE 2: CLASSIFICATION & PRIORITIZATION

### TASK 6: Perform Risk Assessment on Code Modules Based on Audit Findings

**Prerequisites:** Completion of TASK 2 (Naming Violations) and TASK 5 (Performance Baseline)  
**Input:** CSV report from TASK 2 and JSON performance baseline from TASK 5  
**Output:** JSON risk assessment report with modules listed, risk scores (scale 1-10), and identified issues per module  
**Validation:** Confirm that each module receives a numeric risk score based on violation density and performance impact

#### SUBTASK 6.1
Run a static analysis tool to compute code complexity metrics for each module

#### SUBTASK 6.2
Combine naming and performance data to calculate a risk score per module

---

### TASK 7: Score Module Impact and Estimate Refactoring Effort

**Prerequisites:** Completion of TASK 4 (Dead Code Report) and TASK 6 (Risk Assessment)  
**Input:** Dead code JSON report and risk assessment JSON report  
**Output:** CSV report summarizing each module's impact score, estimated refactoring effort (in hours), and priority ranking  
**Validation:** Validate that each module has a corresponding impact and effort entry and that estimated values are numerically defined

#### SUBTASK 7.1
Map each module from TASK 6 to a quantitative impact score using a standardized matrix

#### SUBTASK 7.2
Estimate refactoring effort based on lines of code and interdependency density, and record in CSV

---

### TASK 8: Map Inter-module Dependencies Within the Monorepo

**Prerequisites:** Access to the complete codebase and Node.js environment with madge installed  
**Input:** Entire monorepo codebase  
**Output:** Dependency graph in Graphviz DOT format and complementary JSON dependency map  
**Validation:** Confirm that the dependency graph includes all modules and that the JSON map lists correct relationships by running `npx madge --json .`

#### SUBTASK 8.1
Execute madge with the command `npx madge --json .` to generate the JSON dependency mapping

#### SUBTASK 8.2
Convert the JSON output into a Graphviz DOT file for visual dependency inspection

---

## PHASE 3: REFACTORING EXECUTION

### TASK 9: Execute Automated Code Fixes for Naming Convention Violations

**Prerequisites:** Completion of TASK 2  
**Input:** CSV report from TASK 2 listing naming violations  
**Output:** JSON log detailing all file renaming actions and updates applied  
**Validation:** Verify that all affected file names match the regex `"^[A-Z][a-zA-Z0-9]+\.tsx$"` post-transformation by re-running a file scanner

#### SUBTASK 9.1
Run an automated renaming script that applies regex-based renames on file names using a custom AST or shell script

#### SUBTASK 9.2
Perform a file system diff to confirm that all updated file names conform to the naming standard

---

### TASK 10: Refactor App Router Components to Fully Align with Next.js 15 Standards

**Prerequisites:** TASK 3 completion; Next.js 15 app configuration verified  
**Input:** All files in `app/**/page.tsx` (and associated layout.tsx files)  
**Output:** JSON report summarizing files transformed, updated component signatures, and directory structure changes  
**Validation:** Validate by running `npx next build` ensuring no routing errors and that the JSON report shows all changes

#### SUBTASK 10.1
Apply an automated AST transformation script on app router files to update patterns to Next.js 15 (e.g., update export defaults, add metadata if missing)

#### SUBTASK 10.2
Execute a Next.js build using `npx next build` to ensure successful compilation and valid routing

---

### TASK 11: Migrate React Components to Leverage React 19 Features and Best Practices

**Prerequisites:** React 19 installed; access to `src/components/**`  
**Input:** All React component files under `src/components/**`  
**Output:** JSON change log identifying components updated for Server Components, Suspense integration, and concurrent features  
**Validation:** Confirm through unit tests and static analysis that transformed components are compliant with React 19 patterns

#### SUBTASK 11.1
Scan each React component to identify legacy patterns and missing optimizations using a custom script

#### SUBTASK 11.2
Run an automated code transformation to insert or modify hooks and patterns to reflect React 19 concurrent features

---

### TASK 12: Update tRPC API Endpoints to Conform with tRPC v11 Standards

**Prerequisites:** tRPC v11 dependency installed and configuration confirmed  
**Input:** All API endpoint files located in `src/trpc/**` (or equivalent)  
**Output:** JSON diff report showing pre- and post-transformation versions of API function signatures and middleware integrations  
**Validation:** Validate by compiling the codebase with the TypeScript compiler (`tsc`) and ensuring integration tests pass without errors

#### SUBTASK 12.1
Scan API endpoint files for legacy tRPC patterns using a custom parser or lint rule

#### SUBTASK 12.2
Apply an automated script to replace legacy API calls with v11 patterns and generate a diff log

---

### TASK 13: Optimize Bundle and Improve Performance Metrics Post-refactoring

**Prerequisites:** TASK 5 baseline, TASK 10 and TASK 11 completion  
**Input:** Next.js build output files and performance metrics from previous builds  
**Output:** JSON report documenting bundle size reductions, code splitting adjustments, and performance improvement percentages  
**Validation:** Confirm that the new build shows a measurable bundle size reduction (e.g., minimum 10% improvement) through updated metrics from `npx next build --profile`

#### SUBTASK 13.1
Analyze the bundle using a webpack analyzer tool (e.g., `npx webpack-bundle-analyzer`) and capture metric data

#### SUBTASK 13.2
Apply code splitting and dynamic import strategies using an automated optimization script and re-run performance profiling

---

## PHASE 4: VALIDATION & CLEANUP

### TASK 14: Run Comprehensive Automated Test Suite on the Refactored Codebase

**Prerequisites:** Completion of all preceding refactoring TASKs (TASK 9 through TASK 13) and proper test configuration (Jest, Testing Library, etc.)  
**Input:** Entire monorepo codebase including newly refactored modules  
**Output:** JSON test coverage report and results summary from running the command `npm test` or `npx jest --coverage`  
**Validation:** All tests must pass with 100% success and coverage meeting pre-set thresholds (e.g., ≥90% code coverage)

#### SUBTASK 14.1
Run unit tests using the designated test runner (e.g., `npx jest`)

#### SUBTASK 14.2
Generate and validate the test coverage report in JSON format

---

### TASK 15: Verify Performance Improvements Against Established Baselines

**Prerequisites:** TASK 5 baseline and TASK 13 optimizations completed  
**Input:** Latest Next.js build performance metrics from `npx next build --profile`  
**Output:** JSON report comparing baseline performance metrics with current build metrics (e.g., bundle size, TTI, FCP)  
**Validation:** Confirm that the new performance metrics show a minimum improvement target (e.g., bundle size reduced by at least 10% and improved TTI)

#### SUBTASK 15.1
Run a performance profiling build and capture updated metrics

#### SUBTASK 15.2
Compare new metrics against baseline values and document percentage improvements in JSON

---

### TASK 16: Update Documentation and Perform Final Repository Cleanup

**Prerequisites:** All refactoring, testing, and performance tasks completed successfully  
**Input:** Developer documentation files (e.g., README.md, nextjs-best-practices.md, typescript-best-practices.md) and temporary refactoring logs  
**Output:** Updated documentation in Markdown or HTML format and a JSON cleanup log listing removed temporary files and obsolete logs  
**Validation:** Validate that documentation reflects current code architecture and that no outdated files remain in the repository by cross-checking with a predefined file list

#### SUBTASK 16.1
Revise and update documentation files to include new practices and architecture diagrams

#### SUBTASK 16.2
Execute a cleanup script to delete temporary files and generate a final JSON log verifying cleanup completion